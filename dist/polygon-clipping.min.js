!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["polygon-clipping"]=e():t["polygon-clipping"]=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=12)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));var r=Number.EPSILON*Number.EPSILON;e.cmp=function(t,e){return-Number.EPSILON<t&&t<Number.EPSILON&&-Number.EPSILON<e&&e<Number.EPSILON?0:(t-e)*(t-e)<r*t*e?0:t<e?-1:1},e.cmpPoints=function(t,e){if(t===e)return 0;var n=t.x,i=e.x;if(n<=-Number.EPSILON||Number.EPSILON<=n||i<=-Number.EPSILON||Number.EPSILON<=i){var o=n-i;if(o*o>=r*n*i)return n<i?-1:1}if(n=t.y,i=e.y,n<=-Number.EPSILON||Number.EPSILON<=n||i<=-Number.EPSILON||Number.EPSILON<=i){var s=n-i;if(s*s>=r*n*i)return n<i?-1:1}return 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(0),o=n(2);var s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),void 0===e.events?e.events=[this]:e.events.push(this),this.point=e}return r(t,null,[{key:"compare",value:function(t,e){if(t.point!==e.point){var n=(0,i.cmp)(t.point.x,e.point.x);if(0!==n)return n;var r=(0,i.cmp)(t.point.y,e.point.y);if(0!==r)return r;t.link(e)}if(t.isLeft!==e.isLeft)return t.isLeft?1:-1;if(t.segment.isVertical&&!e.segment.isVertical)return t.isLeft?1:-1;if(!t.segment.isVertical&&e.segment.isVertical)return t.isLeft?-1:1;var o=t.segment.comparePoint(e.otherSE.point);if(0!==o)return o>0?-1:1;var s=t.segment.ringIn.id,u=e.segment.ringIn.id;if(s!==u)return s<u?-1:1;if(t===e)return 0;throw new Error("SweepEvent comparison failed at ["+t.point.x+", "+t.point.y+"]... equal but not identical?")}}]),r(t,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=this.point.events.length,n=t.point.events,r=0,i=n.length;r<i;r++){var o=n[r];this.point.events.push(o),o.point=this.point;for(var s=0,u=e;s<u;s++)this.point.events[s].otherSE.point===o.otherSE.point&&this.point.events[s].segment.registerCoincident(o.segment)}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,n=this.point.events.length;e<n;e++){var r=this.point.events[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult&&t.push(r)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,n=new Map,r=function(r){var i=r.otherSE;n.set(r,{sine:(0,o.sineOfAngle)(e.point,t.point,i.point),cosine:(0,o.cosineOfAngle)(e.point,t.point,i.point)})};return function(t,e){n.has(t)||r(t),n.has(e)||r(e);var o=n.get(t),s=o.sine,u=o.cosine,l=n.get(e),h=l.sine,f=l.cosine,a=(0,i.cmp)(s,0),c=(0,i.cmp)(h,0);return a>=0&&c>=0?(0,i.cmp)(f,u):a<0&&c<0?(0,i.cmp)(u,f):(0,i.cmp)(h,s)}}},{key:"isLeft",get:function(){return this===this.segment.leftSE}},{key:"isRight",get:function(){return this===this.segment.rightSE}},{key:"isOrientationCorrect",get:function(){var t=(0,i.cmpPoints)(this.point,this.otherSE.point);if(t<0)return this.isLeft;if(t>0)return this.isRight;throw new Error("Degenerate segment encountered")}},{key:"otherSE",get:function(){return this.segment.getOtherSE(this)}}]),t}();e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.perpendicular=e.intersection=e.verticalIntersection=e.horizontalIntersection=e.cosineOfAngle=e.sineOfAngle=e.length=e.compareVectorAngles=e.dotProduct=e.crossProduct=void 0;var r=n(0),i=e.crossProduct=function(t,e){return t.x*e.y-t.y*e.x},o=e.dotProduct=function(t,e){return t.x*e.x+t.y*e.y},s=(e.compareVectorAngles=function(t,e,n){var o={x:e.x-t.x,y:e.y-t.y},s={x:n.x-t.x,y:n.y-t.y},u=i(o,s);return(0,r.cmp)(u,0)},e.length=function(t){return Math.sqrt(o(t,t))}),u=(e.sineOfAngle=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},o={x:n.x-t.x,y:n.y-t.y};return i(o,r)/s(o)/s(r)},e.cosineOfAngle=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return o(i,r)/s(i)/s(r)},e.horizontalIntersection=function(t,e,n){return 0===e.y?null:{x:t.x+e.x/e.y*(n-t.y),y:n}}),l=e.verticalIntersection=function(t,e,n){return 0===e.x?null:{x:n,y:t.y+e.y/e.x*(n-t.x)}};e.intersection=function(t,e,n,r){if(0===e.x)return l(n,r,t.x);if(0===r.x)return l(t,e,n.x);if(0===e.y)return u(n,r,t.y);if(0===r.y)return u(t,e,n.y);var o=i(e,r);if(0==o)return null;var s={x:n.x-t.x,y:n.y-t.y},h=i(s,e)/o,f=i(s,r)/o;return{x:(t.x+f*e.x+n.x+h*r.x)/2,y:(t.y+f*e.y+n.y+h*r.y)/2}},e.perpendicular=function(t){return{x:-t.y,y:t.x}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var i=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.types={INTERSECTION:0,UNION:1,XOR:2,DIFFERENCE:3}}return r(t,[{key:"register",value:function(t,e){this.type=t,this.numMultiPolys=e}}]),t}());e.default=i,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=h(n(3)),o=h(n(1)),s=n(8),u=n(0),l=n(2);function h(t){return t&&t.__esModule?t:{default:t}}var f=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.leftSE=e,null!==e&&(e.segment=this),this.rightSE=n,null!==n&&(n.segment=this),this.ringIn=r,this.ringOut=null,this.coincidents=[this],this._clearCache()}return r(t,null,[{key:"compare",value:function(t,e){if(t===e)return 0;var n=t.leftSE.point.x,r=t.leftSE.point.y,i=e.leftSE.point.x,o=e.leftSE.point.y,s=t.rightSE.point.x,l=e.rightSE.point.x;if((0,u.cmp)(l,n)<0)return 1;if((0,u.cmp)(s,i)<0)return-1;var h=t.comparePoint(e.leftSE.point),f=(0,u.cmp)(n,i);if(0!==h||0!==t.comparePoint(e.rightSE.point)||0!==e.comparePoint(t.leftSE.point)||0!==e.comparePoint(t.rightSE.point)){if(f<0)return 1===h?-1:1;if(f>0)return 1===e.comparePoint(t.leftSE.point)?1:-1;var a=(0,u.cmp)(r,o);return 0===a?t.isVertical!==e.isVertical?t.isVertical?1:-1:t.comparePoint(e.rightSE.point)>0?-1:1:a}if(0!==f)return f;if(t.ringIn.id!==e.ringIn.id)return t.ringIn.id<e.ringIn.id?-1:1;throw new Error("Segment comparison (from ["+t.leftSE.point.x+", "+t.leftSE.point.y+"]) -> to ["+t.rightSE.point.x+", "+t.rightSE.point.y+"]) failed...  segments equal but not identical?")}}]),r(t,[{key:"swapEvents",value:function(){var t=this.leftSE;this.leftSE=this.rightSE,this.rightSE=t}},{key:"getOtherSE",value:function(t){if(t===this.leftSE)return this.rightSE;if(t===this.rightSE)return this.leftSE;throw new Error("may only be called by own sweep events")}},{key:"isAnEndpoint",value:function(t){return 0===(0,u.cmpPoints)(t,this.leftSE.point)||0===(0,u.cmpPoints)(t,this.rightSE.point)}},{key:"isPointOn",value:function(t){return(0,s.isInBbox)(this.bbox,t)&&0===this.comparePoint(t)}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=this.vector,n=(0,l.perpendicular)(e),r=(0,l.intersection)(this.leftSE.point,e,t,n),i=(0,u.cmp)(t.y,r.y);return 0!==i?i:(0,u.cmp)(r.x,t.x)}},{key:"getIntersections",value:function(t){var e=(0,s.getBboxOverlap)(this.bbox,t.bbox);if(null===e)return[];for(var n=[],r=(0,s.getUniqueCorners)(e),i=0,o=r.length;i<o;i++){var u=r[i];(this.isAnEndpoint(u)&&t.isPointOn(u)||t.isAnEndpoint(u)&&this.isPointOn(u))&&n.push(u)}if(n.length>0)return n;var h=(0,l.intersection)(this.leftSE.point,this.vector,t.leftSE.point,t.vector);return null!==h&&(0,s.isInBbox)(e,h)?[h]:[]}},{key:"split",value:function(e){e.sort(u.cmpPoints);for(var n=[],r=0;r<e.length;r++)0!==r&&0===(0,u.cmpPoints)(e[r-1],e[r])||n.push(e[r]);for(var i=0,s=(e=n).length;i<s;i++){var l=e[i];if(this.isAnEndpoint(l))throw new Error("Cannot split segment upon endpoint at ["+l.x+", "+l.y+"]")}for(var h=e.shift(),f=[],a=[],c=0,g=this.coincidents.length;c<g;c++){var p=this.coincidents[c],y=new o.default(h),v=new o.default(h);f.push(new t(y,p.rightSE,p.ringIn)),p.rightSE=v,p.rightSE.segment=p,a.push(v),a.push(y)}for(var d=1,m=f.length;d<m;d++)f[d].registerCoincident(f[d-1]);if(e.length>0)for(var E=f[0].split(e),x=0,_=E.length;x<_;x++)a.push(E[x]);return a}},{key:"registerPrev",value:function(t){this.prev=t,this._clearCache()}},{key:"registerRingOut",value:function(t){this.ringOut=t}},{key:"registerCoincident",value:function(t){if(this.coincidents!=t.coincidents){for(var e=t.coincidents,n=0,r=e.length;n<r;n++){var i=e[n];this.coincidents.push(i),i.coincidents=this.coincidents}this.coincidents.sort(function(t,e){return t.ringIn.id-e.ringIn.id})}}},{key:"_prevInResult",value:function(){for(var t=this.prev;t&&!t.isInResult;)t=t.prev;return t}},{key:"_prevNotCoincident",value:function(){for(var t=this,e=this.prev;e&&t.coincidents===e.coincidents;)t=e,e=e.prev;return e}},{key:"_sweepLineEntersRing",value:function(){for(var t=this.prevNotCoincident;t;){for(var e=0,n=t.coincidents.length;e<n;e++){var r=t.coincidents[e];if(r.ringIn===this.ringIn)return!r.sweepLineEntersRing}t=t.prevNotCoincident}return!0}},{key:"_ringsInsideOf",value:function(){if(!this.prev)return[];if(this.coincidents===this.prev.coincidents)return this.prev.ringsInsideOf;for(var t=[],e=this.prev.ringsInsideOf,n=this.prev.getRingsEntering(),r=this.getRingsExiting(),i=0,o=e.length;i<o;i++){var s=e[i];r.includes(s)||t.push(s)}for(var u=0,l=n.length;u<l;u++){var h=n[u];r.includes(h)||t.push(h)}return t}},{key:"getRingsOnEdgeOf",value:function(){for(var t=[],e=0,n=this.coincidents.length;e<n;e++)t.push(this.coincidents[e].ringIn);return t}},{key:"getRingsEntering",value:function(){for(var t=[],e=0,n=this.coincidents.length;e<n;e++){var r=this.coincidents[e];r.sweepLineEntersRing&&t.push(r.ringIn)}return t}},{key:"getRingsExiting",value:function(){for(var t=[],e=0,n=this.coincidents.length;e<n;e++){var r=this.coincidents[e];r.sweepLineEntersRing||t.push(r.ringIn)}return t}},{key:"getRingsEnteringAndExiting",value:function(){for(var t=[],e=[],n=0,r=this.coincidents.length;n<r;n++){var i=this.coincidents[n];i.sweepLineEntersRing?t.push(i.ringIn):e.push(i.ringIn)}return[t,e]}},{key:"_isValidEdgeForPoly",value:function(){var t=void 0,e=void 0,n=this.getRingsEnteringAndExiting();return this.sweepLineEntersRing?(t=n[0],e=n[1]):(e=n[0],t=n[1]),this.ringIn.isValid(t,e,this.ringsInsideOf)}},{key:"getMultiPolysInsideOf",value:function(){for(var t=[],e=0,n=this.ringsInsideOf.length;e<n;e++){var r=this.ringsInsideOf[e].poly;t.includes(r.multiPoly)||r.isInside(this.getRingsOnEdgeOf(),this.ringsInsideOf)&&t.push(r.multiPoly)}return t}},{key:"getMultiPolysSLPEntersAndExits",value:function(t){for(var e=t.slice(0),n=t.slice(0),r=0,i=this.coincidents.length;r<i;r++){var o=this.coincidents[r],s=o.ringIn.poly.multiPoly;o.sweepLineEntersPoly?e.includes(s)||e.push(s):o.sweepLineExitsPoly&&(n.includes(s)||n.push(s))}return[e,n]}},{key:"_isInResult",value:function(){if(this!==this.coincidents[0])return!1;var t=this.getMultiPolysInsideOf(),e=this.getMultiPolysSLPEntersAndExits(t),n=e[0],r=e[1];switch(i.default.type){case i.default.types.UNION:return 0===n.length!==(0===r.length);case i.default.types.INTERSECTION:var o=void 0,s=void 0;return n.length<r.length?(o=n.length,s=r.length):(o=r.length,s=n.length),s===i.default.numMultiPolys&&o<s;case i.default.types.XOR:return Math.abs(n.length-r.length)%2==1;case i.default.types.DIFFERENCE:var u=function(t){return 1===t.length&&t[0].isSubject};return u(n)!==u(r);default:throw new Error("Unrecognized operation type found "+i.default.type)}}},{key:"_clearCache",value:function(){this._cache={}}},{key:"bbox",get:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",get:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isVertical",get:function(){return 0===(0,u.cmp)(this.leftSE.point.x,this.rightSE.point.x)}},{key:"prevInResult",get:function(){var t="prevInResult";return void 0===this._cache[t]&&(this._cache[t]=this["_"+t]()),this._cache[t]}},{key:"prevNotCoincident",get:function(){var t="prevNotCoincident";return void 0===this._cache[t]&&(this._cache[t]=this["_"+t]()),this._cache[t]}},{key:"sweepLineEntersRing",get:function(){var t="sweepLineEntersRing";return void 0===this._cache[t]&&(this._cache[t]=this["_"+t]()),this._cache[t]}},{key:"sweepLineEntersPoly",get:function(){return!!this.isValidEdgeForPoly&&this.ringIn.isExterior===this.sweepLineEntersRing}},{key:"sweepLineExitsPoly",get:function(){return!!this.isValidEdgeForPoly&&this.ringIn.isExterior!==this.sweepLineEntersRing}},{key:"ringsInsideOf",get:function(){var t="ringsInsideOf";return void 0===this._cache[t]&&(this._cache[t]=this["_"+t]()),this._cache[t]}},{key:"isValidEdgeForPoly",get:function(){var t="isValidEdgeForPoly";return void 0===this._cache[t]&&(this._cache[t]=this["_"+t]()),this._cache[t]}},{key:"isInResult",get:function(){var t="isInResult";return void 0===this._cache[t]&&(this._cache[t]=this["_"+t]()),this._cache[t]}}],[{key:"fromRing",value:function(e,n,r){var i=void 0,s=void 0,l=(0,u.cmpPoints)(e,n);if(l<0)i=new o.default(e),s=new o.default(n);else{if(!(l>0))throw new Error("Tried to create degenerate segment at ["+e.x+", "+n.y+"]");i=new o.default(n),s=new o.default(e)}return new t(i,s,r)}}]),t}();e.default=f,t.exports=e.default},function(t,e,n){"use strict";n.r(e),n.d(e,"default",function(){return l});class r{constructor(t,e){this.key=t,this.data=e,this.left=null,this.right=null}}function i(t,e,n){if(null===e)return e;let i,o,s;const u=new r;for(i=o=u;;){const r=n(t,e.key);if(r<0){if(null===e.left)break;if(n(t,e.left.key)<0&&(s=e.left,e.left=s.right,s.right=e,null===(e=s).left))break;o.left=e,o=e,e=e.left}else{if(!(r>0))break;if(null===e.right)break;if(n(t,e.right.key)>0&&(s=e.right,e.right=s.left,s.left=e,null===(e=s).right))break;i.right=e,i=e,e=e.right}}return i.right=e.left,o.left=e.right,e.left=u.right,e.right=u.left,e}function o(t,e,n,o,s){const u=new r(t,e);if(s._size++,null===n)return u.left=u.right=null,u;const l=o(t,(n=i(t,n,o)).key);return l<0?(u.left=n.left,u.right=n,n.left=null):l>=0&&(u.right=n.right,u.left=n,n.right=null),u}function s(t,e,n,r){let o;return null===e?null:t===(e=i(t,e,n)).key?(null===e.left?o=e.right:(o=i(t,e.left,n)).right=e.right,r._size--,o):e}function u(t,e,n){let r,o;if(null===e)r=o=null;else{const s=n((e=i(t,e,n)).key,t);0===s?(r=e.left,o=e.right):s<0?(o=e.right,e.right=null,r=e):(r=e.left,e.left=null,o=e)}return{left:r,right:o}}class l{constructor(t=function(t,e){return t>e?1:t<e?-1:0}){this._comparator=t,this._root=null,this._size=0}insert(t,e){return this._root=o(t,e,this._root,this._comparator,this)}add(t,e){return this._root=function(t,e,n,o,s){const u=new r(t,e);if(null===n)return u.left=u.right=null,s._size++,u;const l=o(t,(n=i(t,n,o)).key);return 0===l?n:(l<0?(u.left=n.left,u.right=n,n.left=null):l>0&&(u.right=n.right,u.left=n,n.right=null),s._size++,u)}(t,e,this._root,this._comparator,this)}remove(t){this._root=s(t,this._root,this._comparator,this)}pop(){let t=this._root;if(t){for(;t.left;)t=t.left;return this._root=i(t.key,this._root,this._comparator),this._root=s(t.key,this._root,this._comparator,this),{key:t.key,data:t.data}}return null}findStatic(t){let e=this._root;const n=this._comparator;for(;e;){const r=n(t,e.key);if(0===r)return e;e=r<0?e.left:e.right}return null}find(t){return this._root&&(this._root=i(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root}contains(t){let e=this._root;const n=this._comparator;for(;e;){const r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1}forEach(t,e){let n=this._root;const r=[];let i=!1;for(;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),t.call(e,n),n=n.right):i=!0;return this}range(t,e,n,r){const i=[],o=this._comparator;let s,u=this._root;for(;0!==i.length||u;)if(u)i.push(u),u=u.left;else{if((s=o((u=i.pop()).key,e))>0)break;if(o(u.key,t)>=0&&n.call(r,u))return this;u=u.right}return this}keys(){const t=[];return this.forEach(({key:e})=>t.push(e)),t}values(){const t=[];return this.forEach(({data:e})=>t.push(e)),t}min(){return this._root?this.minNode(this._root).key:null}max(){return this._root?this.maxNode(this._root).key:null}minNode(t=this._root){if(t)for(;t.left;)t=t.left;return t}maxNode(t=this._root){if(t)for(;t.right;)t=t.right;return t}at(t){let e=this._root,n=!1,r=0;const i=[];for(;!n;)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),r===t)return e;r++,e=e.right}else n=!0;return null}next(t){let e=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}const r=this._comparator;for(;e;){const i=r(t.key,e.key);if(0===i)break;i<0?(n=e,e=e.left):e=e.right}return n}prev(t){let e=this._root,n=null;if(null!==t.left){for(n=t.left;n.right;)n=n.right;return n}const r=this._comparator;for(;e;){const i=r(t.key,e.key);if(0===i)break;i<0?e=e.left:(n=e,e=e.right)}return n}clear(){return this._root=null,this._size=0,this}toList(){return function(t){var e=t,n=[],r=!1;const i={next:null};let o=i;for(;!r;)e?(n.push(e),e=e.left):n.length>0?e=(e=o=o.next=n.pop()).right:r=!0;return o.next=null,i.next}(this._root)}load(t=[],e=[],n=!1){let r=t.length;const i=this._comparator;if(n&&function t(e,n,r,i,o){if(r>=i)return;const s=e[r+i>>1];let u=r-1;let l=i+1;for(;;){do{u++}while(o(e[u],s)<0);do{l--}while(o(e[l],s)>0);if(u>=l)break;let t=e[u];e[u]=e[l],e[l]=t,t=n[u],n[u]=n[l],n[l]=t}t(e,n,r,l,o);t(e,n,l+1,i,o)}(t,e,0,r-1,i),null===this._root)this._root=function t(e,n,r,i,o){const s=o-i;if(s>0){const u=i+Math.floor(s/2),l=n[u],h=r[u],f={key:l,data:h,parent:e};return f.left=t(f,n,r,i,u),f.right=t(f,n,r,u+1,o),f}return null}(this._root,t,e,0,r),this._size=r;else{const n=function(t,e,n=((t,e)=>t-e)){const r={};let i=r,o=t,s=e;for(;null!==o&&null!==s;)n(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;null!==o?i.next=o:null!==s&&(i.next=s);return r.next}(this.toList(),function(t,e){const n={next:null};let r=n;for(let n=0;n<t.length;n++)r=r.next={key:t[n],data:e[n]};return r.next=null,n.next}(t,e),i);r=this._size+r,this._root=function t(e,n,r){const i=r-n;if(i>0){const o=n+Math.floor(i/2),s=t(e,n,o),u=e.head;return u.left=s,e.head=e.head.next,u.right=t(e,o+1,r),u}return null}({head:n},0,r)}return this}isEmpty(){return null===this._root}get size(){return this._size}toString(t=(t=>t.key)){const e=[];return function t(e,n,r,i,o){if(e){i(`${n}${r?"└── ":"├── "}${o(e)}\n`);const s=n+(r?"    ":"│   ");e.left&&t(e.left,s,!1,i,o),e.right&&t(e.right,s,!0,i,o)}}(this._root,"",!0,t=>e.push(t),t),e.join("")}update(t,e,n){const r=this._comparator;let{left:s,right:l}=u(t,this._root,r);this._size--,r(t,e)<0?l=o(e,n,l,r,this):s=o(e,n,s,r,this),this._root=function(t,e,n){return null===e?t:null===t?e:((e=i(t.key,e,n)).left=t,e)}(s,l,r)}split(t){return u(t,this._root,this._comparator)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=s(n(5)),o=s(n(4));function s(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.default.compare;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tree=new i.default(e),this.segments=[]}return r(t,[{key:"process",value:function(t){var e=t.segment,n=[],r=t.isLeft?this.tree.insert(e):this.tree.find(e),i=this.tree.prev(r),o=i?i.key:null,s=this.tree.next(r),u=s?s.key:null;if(t.isLeft){var l=[];if(o){var h=o.getIntersections(e);if(h.length>0){for(var f=this._possibleSplit(o,h),a=0,c=f.length;a<c;a++)n.push(f[a]);for(var g=0,p=h.length;g<p;g++){var y=h[g];e.isAnEndpoint(y)||l.push(y)}}}if(u){var v=u.getIntersections(e);if(v.length>0){for(var d=this._possibleSplit(u,v),m=0,E=d.length;m<E;m++)n.push(d[m]);for(var x=0,_=v.length;x<_;x++){var b=v[x];e.isAnEndpoint(b)||l.push(b)}}}if(n.length>0||l.length>0){if(this.tree.remove(e),l.length>0)for(var k=e.split(l),P=0,O=k.length;P<O;P++)n.push(k[P]);n.push(t)}else this.segments.push(e),e.registerPrev(o)}else{if(o&&u){var w=o.getIntersections(u);if(w.length>0){for(var S=this._possibleSplit(o,w),I=0,R=S.length;I<R;I++)n.push(S[I]);for(var N=0,M=(S=this._possibleSplit(u,w)).length;N<M;N++)n.push(S[N])}}this.tree.remove(e)}for(var A=0,L=n.length;A<L;A++){var j=n[A];j.isOrientationCorrect||j.segment.swapEvents()}return n}},{key:"_possibleSplit",value:function(t,e){for(var n=[],r=0,i=e.length;r<i;r++){var o=e[r];t.isAnEndpoint(o)||n.push(o)}var s=[];if(n.length>0){for(var u=[],l=0,h=t.coincidents.length;l<h;l++){var f=this.tree.find(t.coincidents[l]);null!==f&&(u.push(f),this.tree.remove(f.key))}s=t.split(n);for(var a=0,c=u.length;a<c;a++)this.tree.insert(u[a].key)}return s}}]),t}();e.default=u,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MultiPolyOut=e.PolyOut=e.RingOut=void 0;var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(2),s=n(1),u=(r=s)&&r.__esModule?r:{default:r};function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.RingOut=function(){function t(e){l(this,t),this.events=e;for(var n=0,r=e.length;n<r;n++)e[n].segment.registerRingOut(this);this.poly=null,this._clearCache()}return i(t,null,[{key:"factory",value:function(e){for(var n=[],r=0,i=e.length;r<i;r++){var o=e[r];if(o.isInResult&&!o.ringOut){for(var s=null,u=o.leftSE,l=o.rightSE,h=[u],f=u.point,a=[];s=u,u=l,h.push(u),u.point!==f;)for(;;){var c=u.getAvailableLinkedEvents();if(0===c.length){var g=h[0].point,p=h[h.length-1].point;throw new Error("Unable to complete output ring starting at ["+g.x+", "+g.y+"]. Last matching segment found ends at ["+p.x+", "+p.y+"].")}if(1===c.length){l=c[0].otherSE;break}for(var y=null,v=0,d=a.length;v<d;v++)if(a[v].point===u.point){y=v;break}if(null===y){a.push({index:h.length,point:u.point});var m=u.getLeftmostComparator(s);l=c.sort(m)[0].otherSE;break}var E=a.splice(y)[0],x=h.splice(E.index);x.unshift(x[0].otherSE),n.push(new t(x.reverse()))}n.push(new t(h))}}return n}}]),i(t,[{key:"registerPoly",value:function(t){this.poly=t}},{key:"getGeom",value:function(){for(var t=[[this.events[0].point.x,this.events[0].point.y]],e=1,n=this.events.length-1;e<n;e++){var r=this.events[e-1].point,i=this.events[e].point,s=this.events[e+1].point;0!==(0,o.compareVectorAngles)(i,r,s)&&t.push([i.x,i.y])}var u=this.events[this.events.length-2].point,l=this.events[0].point,h=this.events[1].point;return 0===(0,o.compareVectorAngles)(l,u,h)&&t.shift(),0===t.length?null:(t.push(t[0]),this.isExteriorRing?t:t.reverse())}},{key:"_clearCache",value:function(){this._cache={}}},{key:"_getCached",value:function(t,e){return void 0===this._cache[t]&&(this._cache[t]=this["_"+t].bind(this)()),this._cache[t]}},{key:"_isExteriorRing",value:function(){return!this.enclosingRing||!!this.enclosingRing.enclosingRing&&this.enclosingRing.enclosingRing.isExteriorRing}},{key:"_enclosingRing",value:function(){for(var t=this.events[0],e=1,n=this.events.length;e<n;e++){var r=this.events[e];u.default.compare(t,r)>0&&(t=r)}for(var i=t.segment.prevInResult,o=i?i.prevInResult:null;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing!==i.ringOut?i.ringOut:i.ringOut.enclosingRing;o=(i=o.prevInResult)?i.prevInResult:null}}},{key:"enclosingRing",get:function(){return this._getCached("enclosingRing")}},{key:"isExteriorRing",get:function(){return this._getCached("isExteriorRing")}}]),t}();var h=e.PolyOut=function(){function t(e){l(this,t),this.exteriorRing=e,e.registerPoly(this),this.interiorRings=[]}return i(t,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.registerPoly(this)}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,n=this.interiorRings.length;e<n;e++){var r=this.interiorRings[e].getGeom();null!==r&&t.push(r)}return t}}]),t}();e.MultiPolyOut=function(){function t(e){l(this,t),this.rings=e,this.polys=this._composePolys(e)}return i(t,[{key:"getGeom",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++){var r=this.polys[e].getGeom();null!==r&&t.push(r)}return t}},{key:"_composePolys",value:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];i.poly||(i.isExteriorRing?e.push(new h(i)):(i.enclosingRing.poly||e.push(new h(i.enclosingRing)),i.enclosingRing.poly.addInterior(i)))}return e}}]),t}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getUniqueCorners=e.getBboxOverlap=e.doBboxesOverlap=e.isInBbox=void 0;var r=n(0),i=(e.isInBbox=function(t,e){var n=t.ll.x,i=t.ll.y,o=t.ur.x,s=t.ur.y,u=e.x,l=e.y;return(0,r.cmp)(n,u)<=0&&(0,r.cmp)(u,o)<=0&&(0,r.cmp)(i,l)<=0&&(0,r.cmp)(l,s)<=0},e.doBboxesOverlap=function(t,e){return!((0,r.cmp)(e.ur.x,t.ll.x)<0||(0,r.cmp)(t.ur.x,e.ll.x)<0||(0,r.cmp)(e.ur.y,t.ll.y)<0||(0,r.cmp)(t.ur.y,e.ll.y)<0)});e.getBboxOverlap=function(t,e){if(!i(t,e))return null;var n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:n,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:r,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}},e.getUniqueCorners=function(t){var e=t.ll.x,n=t.ll.y,i=t.ur.x,o=t.ur.y,s=0===(0,r.cmp)(e,i),u=0===(0,r.cmp)(n,o);return s&&u?[{x:e,y:n}]:s?[{x:e,y:n},{x:e,y:o}]:u?[{x:e,y:n},{x:i,y:n}]:[{x:e,y:n},{x:e,y:o},{x:i,y:n},{x:i,y:o}]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MultiPolyIn=e.PolyIn=e.RingIn=void 0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=o(n(4));o(n(1));function o(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var u=0,l=e.RingIn=function(){function t(e,n){s(this,t),this.id=u++,this.poly=n,this.segments=[];for(var r=e[0],o=1,l=e.length;o<l;o++){var h=e[o];this.segments.push(i.default.fromRing(r,h,this)),r=h}this.segments.push(i.default.fromRing(r,e[0],this))}return r(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.segments.length;e<n;e++){var r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}},{key:"isValid",value:function(t,e,n){var r=this.poly.exteriorRing,i=this.poly.interiorRings;if(this===r){for(var o=0,s=n.length;o<s;o++)if(i.includes(n[o]))return!1;for(var u=0,l=t.length;u<l;u++)if(i.includes(t[u]))return!1;return!0}if(!n.includes(r)&&!e.includes(r))return!1;for(var h=0,f=n.length;h<f;h++)if(i.includes(n[h]))return!1;for(var a=0,c=e.length;a<c;a++)if(i.includes(e[a]))return!1;return!0}},{key:"isExterior",get:function(){return this.poly.exteriorRing===this}},{key:"isInterior",get:function(){return this.poly.exteriorRing!==this}}]),t}(),h=e.PolyIn=function(){function t(e,n){s(this,t),this.exteriorRing=new l(e[0],this),this.interiorRings=[];for(var r=1,i=e.length;r<i;r++)this.interiorRings.push(new l(e[r],this));this.multiPoly=n}return r(t,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,n=this.interiorRings.length;e<n;e++)for(var r=this.interiorRings[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}},{key:"isInside",value:function(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n].poly===this)return!1;for(var i=!1,o=0,s=e.length;o<s;o++){var u=e[o];if(u.poly===this){if(u.isInterior)return!1;i=!0}}return i}}]),t}();e.MultiPolyIn=function(){function t(e){s(this,t),this.polys=[];for(var n=0,r=e.length;n<r;n++)this.polys.push(new h(e[n],this));this.isSubject=!1}return r(t,[{key:"markAsSubject",value:function(){this.isSubject=!0}},{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++)for(var r=this.polys[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),t}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.cleanRing=e.cleanMultiPoly=e.forceMultiPoly=e.pointsAsObjects=void 0;var r=n(0),i=n(2),o=(e.pointsAsObjects=function(t){var e=[];if(!Array.isArray(t))throw new Error("Input is not a Polygon or MultiPolygon");for(var n=0,r=t.length;n<r;n++){if(!Array.isArray(t[n])||0==t[n].length)throw new Error("Input is not a Polygon or MultiPolygon");e.push([]);for(var i=0,o=t[n].length;i<o;i++){if(!Array.isArray(t[n][i])||0==t[n][i].length)throw new Error("Input is not a Polygon or MultiPolygon");if(Array.isArray(t[n][i][0])){e[n].push([]);for(var s=0,u=t[n][i].length;s<u;s++){if(!Array.isArray(t[n][i][s])||t[n][i][s].length<2)throw new Error("Input is not a Polygon or MultiPolygon");if(t[n][i][s].length>2)throw new Error("Input has more than two coordinates. Only 2-dimensional polygons supported.");e[n][i].push({x:t[n][i][s][0],y:t[n][i][s][1]})}}else{if(t[n][i].length<2)throw new Error("Input is not a Polygon or MultiPolygon");if(t[n][i].length>2)throw new Error("Input has more than two coordinates. Only 2-dimensional polygons supported.");e[n].push({x:t[n][i][0],y:t[n][i][1]})}}}return e},e.forceMultiPoly=function(t){if(Array.isArray(t)){if(0===t.length)return;if(Array.isArray(t[0])){if(Array.isArray(t[0][0])&&"number"==typeof t[0][0][0].x&&"number"==typeof t[0][0][0].y)return;if("number"==typeof t[0][0].x&&"number"==typeof t[0][0].y)return void t.unshift(t.splice(0))}}throw new Error("Unrecognized input - not a polygon nor multipolygon")},e.cleanMultiPoly=function(t){for(var e=0;e<t.length;){var n=t[e];if(0!==n.length){var r=n[0];if(o(r),0!==r.length){for(var i=1;i<n.length;){var s=n[i];o(s),0===s.length?n.splice(i,1):i++}e++}else t.splice(e,1)}else t.splice(e,1)}},e.cleanRing=function(t){if(0!==t.length){0===(0,r.cmpPoints)(t[0],t[t.length-1])&&t.pop();for(var e=function(t,e,n){return 0===(0,r.cmpPoints)(t,e)||0===(0,r.cmpPoints)(e,n)||0===(0,i.compareVectorAngles)(e,t,n)},n=0,o=void 0,s=void 0;n<t.length;)o=0===n?t[t.length-1]:t[n-1],s=n===t.length-1?t[0]:t[n+1],e(o,t[n],s)?t.splice(n,1):n++;for(;t.length<3&&t.length>0;)t.pop()}})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){for(var f=[i.pointsAsObjects(e)],a=0,c=n.length;a<c;a++)f.push(i.pointsAsObjects(n[a]));for(var g=0,p=f.length;g<p;g++)i.forceMultiPoly(f[g]),i.cleanMultiPoly(f[g]);for(var y=[],v=0,d=f.length;v<d;v++)y.push(new o.MultiPolyIn(f[v]));y[0].markAsSubject(),u.default.register(t,y.length);for(var m=new r.default(l.default.compare),E=0,x=y.length;E<x;E++)for(var _=y[E].getSweepEvents(),b=0,k=_.length;b<k;b++)m.insert(_[b]);var P=new h.default,O=void 0;for(;O=m.pop();)for(var w=P.process(O.key),S=0,I=w.length;S<I;S++)m.insert(w[S]);var R=s.RingOut.factory(P.segments);return new s.MultiPolyOut(R).getGeom()};var r=a(n(5)),i=f(n(10)),o=f(n(9)),s=f(n(7)),u=a(n(3)),l=a(n(1)),h=a(n(6));function f(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function a(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=o(n(11)),i=o(n(3));function o(t){return t&&t.__esModule?t:{default:t}}e.default={union:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return(0,r.default)(i.default.types.UNION,t,n)},intersection:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return(0,r.default)(i.default.types.INTERSECTION,t,n)},xor:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return(0,r.default)(i.default.types.XOR,t,n)},difference:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return(0,r.default)(i.default.types.DIFFERENCE,t,n)}},t.exports=e.default}])});