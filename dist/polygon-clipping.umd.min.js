!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).polygonClipping=e()}(this,function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}var r=function e(n,r){t(this,e),this.key=n,this.data=r,this.left=null,this.right=null};function i(t,e){return t>e?1:t<e?-1:0}function o(t,e,n){if(null===e)return e;var i,o,u,s=new r;for(i=o=s;;){var l=n(t,e.key);if(l<0){if(null===e.left)break;if(n(t,e.left.key)<0&&(u=e.left,e.left=u.right,u.right=e,null===(e=u).left))break;o.left=e,o=e,e=e.left}else{if(!(l>0))break;if(null===e.right)break;if(n(t,e.right.key)>0&&(u=e.right,e.right=u.left,u.left=e,null===(e=u).right))break;i.right=e,i=e,e=e.right}}return i.right=e.left,o.left=e.right,e.left=s.right,e.right=s.left,e}function u(t,e,n,i,u){var s=new r(t,e);if(u._size++,null===n)return s.left=s.right=null,s;var l=i(t,(n=o(t,n,i)).key);return l<0?(s.left=n.left,s.right=n,n.left=null):l>=0&&(s.right=n.right,s.left=n,n.right=null),s}function s(t,e,n,r){var i;return null===e?null:0===n(t,(e=o(t,e,n)).key)?(null===e.left?i=e.right:(i=o(t,e.left,n)).right=e.right,r._size--,i):e}function l(t,e,n){var r,i;if(null===e)r=i=null;else{var u=n((e=o(t,e,n)).key,t);0===u?(r=e.left,i=e.right):u<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}var h=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;t(this,e),this._comparator=n,this._root=null,this._size=0}return n(e,[{key:"insert",value:function(t,e){return this._root=u(t,e,this._root,this._comparator,this)}},{key:"add",value:function(t,e){return this._root=function(t,e,n,i,u){var s=new r(t,e);if(null===n)return s.left=s.right=null,u._size++,s;var l=i(t,(n=o(t,n,i)).key);return 0===l?n:(l<0?(s.left=n.left,s.right=n,n.left=null):l>0&&(s.right=n.right,s.left=n,n.right=null),u._size++,s)}(t,e,this._root,this._comparator,this)}},{key:"remove",value:function(t){this._root=s(t,this._root,this._comparator,this)}},{key:"pop",value:function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=o(t.key,this._root,this._comparator),this._root=s(t.key,this._root,this._comparator,this),{key:t.key,data:t.data}}return null}},{key:"findStatic",value:function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return e;e=r<0?e.left:e.right}return null}},{key:"find",value:function(t){return this._root&&(this._root=o(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root}},{key:"contains",value:function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1}},{key:"forEach",value:function(t,e){for(var n=this._root,r=[],i=!1;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),t.call(e,n),n=n.right):i=!0;return this}},{key:"range",value:function(t,e,n,r){for(var i=[],o=this._comparator,u=this._root;0!==i.length||u;)if(u)i.push(u),u=u.left;else{if(o((u=i.pop()).key,e)>0)break;if(o(u.key,t)>=0&&n.call(r,u))return this;u=u.right}return this}},{key:"keys",value:function(){var t=[];return this.forEach(function(e){var n=e.key;return t.push(n)}),t}},{key:"values",value:function(){var t=[];return this.forEach(function(e){var n=e.data;return t.push(n)}),t}},{key:"min",value:function(){return this._root?this.minNode(this._root).key:null}},{key:"max",value:function(){return this._root?this.maxNode(this._root).key:null}},{key:"minNode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._root;if(t)for(;t.left;)t=t.left;return t}},{key:"maxNode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._root;if(t)for(;t.right;)t=t.right;return t}},{key:"at",value:function(t){for(var e=this._root,n=!1,r=0,i=[];!n;)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),r===t)return e;r++,e=e.right}else n=!0;return null}},{key:"next",value:function(t){var e=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}for(var r=this._comparator;e;){var i=r(t.key,e.key);if(0===i)break;i<0?(n=e,e=e.left):e=e.right}return n}},{key:"prev",value:function(t){var e=this._root,n=null;if(null!==t.left){for(n=t.left;n.right;)n=n.right;return n}for(var r=this._comparator;e;){var i=r(t.key,e.key);if(0===i)break;i<0?e=e.left:(n=e,e=e.right)}return n}},{key:"clear",value:function(){return this._root=null,this._size=0,this}},{key:"toList",value:function(){return function(t){var e=t,n=[],r=!1,i={next:null},o=i;for(;!r;)e?(n.push(e),e=e.left):n.length>0?e=(e=o=o.next=n.pop()).right:r=!0;return o.next=null,i.next}(this._root)}},{key:"load",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.length,i=this._comparator;if(n&&function t(e,n,r,i,o){if(r>=i)return;var u=e[r+i>>1];var s=r-1;var l=i+1;for(;;){do{s++}while(o(e[s],u)<0);do{l--}while(o(e[l],u)>0);if(s>=l)break;var h=e[s];e[s]=e[l],e[l]=h,h=n[s],n[s]=n[l],n[l]=h}t(e,n,r,l,o);t(e,n,l+1,i,o)}(t,e,0,r-1,i),null===this._root)this._root=function t(e,n,r,i,o){var u=o-i;if(u>0){var s=i+Math.floor(u/2),l=n[s],h=r[s],f={key:l,data:h,parent:e};return f.left=t(f,n,r,i,s),f.right=t(f,n,r,s+1,o),f}return null}(this._root,t,e,0,r),this._size=r;else{var o=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t,e){return t-e},r={},i=r,o=t,u=e;for(;null!==o&&null!==u;)n(o.key,u.key)<0?(i.next=o,o=o.next):(i.next=u,u=u.next),i=i.next;null!==o?i.next=o:null!==u&&(i.next=u);return r.next}(this.toList(),function(t,e){for(var n={next:null},r=n,i=0;i<t.length;i++)r=r.next={key:t[i],data:e[i]};return r.next=null,n.next}(t,e),i);r=this._size+r,this._root=function t(e,n,r){var i=r-n;if(i>0){var o=n+Math.floor(i/2),u=t(e,n,o),s=e.head;return s.left=u,e.head=e.head.next,s.right=t(e,o+1,r),s}return null}({head:o},0,r)}return this}},{key:"isEmpty",value:function(){return null===this._root}},{key:"toString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(t){return t.key},e=[];return function t(e,n,r,i,o){if(e){i("".concat(n).concat(r?"└── ":"├── ").concat(o(e),"\n"));var u=n+(r?"    ":"│   ");e.left&&t(e.left,u,!1,i,o),e.right&&t(e.right,u,!0,i,o)}}(this._root,"",!0,function(t){return e.push(t)},t),e.join("")}},{key:"update",value:function(t,e,n){var r=this._comparator,i=l(t,this._root,r),s=i.left,h=i.right;this._size--,r(t,e)<0?h=u(e,n,h,r,this):s=u(e,n,s,r,this),this._root=function(t,e,n){return null===e?t:null===t?e:((e=o(t.key,e,n)).left=t,e)}(s,h,r)}},{key:"split",value:function(t){return l(t,this._root,this._comparator)}},{key:"size",get:function(){return this._size}}]),e}();var f=Number.EPSILON;void 0===f&&(f=Math.pow(2,-52));var a=f*f,c=function(t,e){return-f<t&&t<f&&-f<e&&e<f?0:(t-e)*(t-e)<a*t*e?0:t<e?-1:1},v=function(t,e){if(t===e)return 0;var n=t.x,r=e.x;if(n<=-f||f<=n||r<=-f||f<=r){var i=n-r;if(i*i>=a*n*r)return n<r?-1:1}if(n=t.y,r=e.y,n<=-f||f<=n||r<=-f||f<=r){var o=n-r;if(o*o>=a*n*r)return n<r?-1:1}return 0},g=function(t,e){var n=(t+e)/2;return 0===c(n,t)||0===c(n,e)},y=function(t,e){var n={x:(t.x+e.x)/2,y:(t.y+e.y)/2};return 0===v(n,t)||0===v(n,e)},p=function(t,e){return t.x*e.y-t.y*e.x},x=function(t,e){return t.x*e.x+t.y*e.y},E=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y},o=p(r,i);return c(o,0)},m=function(t){return Math.sqrt(x(t,t))},d=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return x(i,r)/m(i)/m(r)},k=function(t,e,n){if(t.x===e.x)return{x:t.x,y:n.y};if(t.y===e.y)return{x:n.x,y:t.y};var r={x:t.x-n.x,y:t.y-n.y},i={x:e.x-n.x,y:e.y-n.y},o=t,u=e;x(r,r)>x(i,i)&&(u=t,o=e);var s={x:u.x-o.x,y:u.y-o.y},l={x:n.x-o.x,y:n.y-o.y},h=x(s,l)/x(s,s);return{x:o.x+h*s.x,y:o.y+h*s.y}},S=function(t,e,n){return 0===e.y?null:{x:t.x+e.x/e.y*(n-t.y),y:n}},_=function(t,e,n){return 0===e.x?null:{x:n,y:t.y+e.y/e.x*(n-t.x)}},w=function(t){var e=[];if(!Array.isArray(t))throw new Error("Input is not a Polygon or MultiPolygon");for(var n=0,r=t.length;n<r;n++){if(!Array.isArray(t[n])||0==t[n].length)throw new Error("Input is not a Polygon or MultiPolygon");e.push([]);for(var i=0,o=t[n].length;i<o;i++){if(!Array.isArray(t[n][i])||0==t[n][i].length)throw new Error("Input is not a Polygon or MultiPolygon");if(Array.isArray(t[n][i][0])){e[n].push([]);for(var u=0,s=t[n][i].length;u<s;u++){if(!Array.isArray(t[n][i][u])||t[n][i][u].length<2)throw new Error("Input is not a Polygon or MultiPolygon");if(t[n][i][u].length>2)throw new Error("Input has more than two coordinates. Only 2-dimensional polygons supported.");e[n][i].push({x:t[n][i][u][0],y:t[n][i][u][1]})}}else{if(t[n][i].length<2)throw new Error("Input is not a Polygon or MultiPolygon");if(t[n][i].length>2)throw new Error("Input has more than two coordinates. Only 2-dimensional polygons supported.");e[n].push({x:t[n][i][0],y:t[n][i][1]})}}}return e},R=function(t){if(Array.isArray(t)){if(0===t.length)return;if(Array.isArray(t[0])){if(Array.isArray(t[0][0])&&"number"==typeof t[0][0][0].x&&"number"==typeof t[0][0][0].y)return;if("number"==typeof t[0][0].x&&"number"==typeof t[0][0].y)return void t.unshift(t.splice(0))}}throw new Error("Unrecognized input - not a polygon nor multipolygon")},b=function(t){for(var e=0;e<t.length;){var n=t[e];if(0!==n.length){var r=n[0];if(A(r),0!==r.length){for(var i=1;i<n.length;){var o=n[i];A(o),0===o.length?n.splice(i,1):i++}e++}else t.splice(e,1)}else t.splice(e,1)}},A=function(t){if(0!==t.length){0===v(t[0],t[t.length-1])&&t.pop();for(var e,n,r=function(t,e,n){return 0===v(t,e)||0===v(e,n)||0===E(e,t,n)},i=0;i<t.length;)e=0===i?t[t.length-1]:t[i-1],n=i===t.length-1?t[0]:t[i+1],r(e,t[i],n)?t.splice(i,1):i++;for(;t.length<3&&t.length>0;)t.pop()}},P=0,I=function(){function e(n,r){t(this,e),void 0===n.events?n.events=[this]:n.events.push(this),this.point=n,this.isLeft=r,this.id=++P}return n(e,null,[{key:"compare",value:function(t,e){if(t.point!==e.point){var n=c(t.point.x,e.point.x);if(0!==n)return n;var r=c(t.point.y,e.point.y);if(0!==r)return r;t.link(e)}if(t.isLeft!==e.isLeft)return t.isLeft?1:-1;if(t===e)return 0;for(var i=t,o=e;i.consumedBy;)i=i.consumedBy;for(;o.consumedBy;)o=o.consumedBy;if(i!==o){var u=t.segment.isVertical(),s=e.segment.isVertical();if(u&&!s)return t.isLeft?1:-1;if(!u&&s)return t.isLeft?-1:1;var l=t.segment.compareVertically(e.otherSE.point);if(1===l)return-1;if(-1===l)return 1;var h=e.segment.compareVertically(t.otherSE.point);if(0!==h)return h}if(t.id<e.id)return-1;if(t.id>e.id)return 1;throw new Error("SweepEvent comparison failed at [".concat(t.point.x,", ").concat(t.point.y,"]"))}}]),n(e,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=t.point.events,n=0,r=e.length;n<r;n++){var i=e[n];this.point.events.push(i),i.point=this.point}this.segment.checkForConsuming(),t.segment.checkForConsuming()}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,n=this.point.events.length;e<n;e++){var r=this.point.events[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,n=new Map,r=function(r){var i,o,u,s,l,h=r.otherSE;n.set(r,{sine:(i=e.point,o=t.point,u=h.point,s={x:o.x-i.x,y:o.y-i.y},l={x:u.x-i.x,y:u.y-i.y},p(l,s)/m(l)/m(s)),cosine:d(e.point,t.point,h.point)})};return function(t,e){n.has(t)||r(t),n.has(e)||r(e);var i=n.get(t),o=i.sine,u=i.cosine,s=n.get(e),l=s.sine,h=s.cosine,f=c(o,0),a=c(l,0);return f>=0&&a>=0?c(h,u):f<0&&a<0?c(u,h):c(l,o)}}}]),e}(),B=function(){function e(n,r,i){t(this,e),this.leftSE=n,n.segment=this,n.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=n,this.ringsIn=i,this._cache={}}return n(e,null,[{key:"compare",value:function(t,e){var n=t.leftSE.point.x,r=t.leftSE.point.y,i=e.leftSE.point.x,o=e.leftSE.point.y,u=t.rightSE.point.x,s=e.rightSE.point.x;if(c(s,n)<0)return 1;if(c(u,i)<0)return-1;for(var l,h,f,a,v=t,g=e;v.consumedBy;)v=v.consumedBy;for(;g.consumedBy;)g=g.consumedBy;if(v===g){if(t===e)return 0;var y=t.leftSE.id,p=e.leftSE.id;if(y<p)return-1;if(y>p)return 1}else if(0===(l=t.comparePoint(e.leftSE.point))&&0===(h=t.comparePoint(e.rightSE.point))&&0===(f=e.comparePoint(t.leftSE.point))&&0===(a=e.comparePoint(t.rightSE.point))){var x=c(n,i);if(0!==x)return x;var E=t.leftSE.id,m=e.leftSE.id;if(E<m)return-1;if(E>m)return 1}else{var d=c(n,i);if(d<0){if(l>0)return-1;if(l<0)return 1}if(d>0&&(void 0===f&&(f=e.comparePoint(t.leftSE.point)),0!==f))return f;var k=c(r,o);if(0!==k)return k;var S=t.isVertical();if(S!==e.isVertical())return S?1:-1;if(void 0===h&&(h=t.comparePoint(e.rightSE.point)),h>0)return-1;if(h<0)return 1;if(void 0===a&&(a=e.comparePoint(t.rightSE.point)),0!==a)return a}throw new Error("Segment comparison of "+"[".concat(t.leftSE.point.x,", ").concat(t.leftSE.point.y,"] -> [").concat(t.rightSE.point.x,", ").concat(t.rightSE.point.y,"] ")+"against "+"[".concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> [").concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"failed. Please submit a bug report.")}}]),n(e,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isVertical",value:function(){return 0===c(this.leftSE.point.x,this.rightSE.point.x)}},{key:"isAnEndpoint",value:function(t){return 0===v(t,this.leftSE.point)||0===v(t,this.rightSE.point)}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=k(this.leftSE.point,this.rightSE.point,t),n=c(t.y,e.y);if(0!==n)return n;var r=c(t.x,e.x),i=c(this.leftSE.point.y,this.rightSE.point.y);if(r>0)return i;if(r<0){if(i>0)return-1;if(i<0)return 1}return 0}},{key:"compareVertically",value:function(t){if(this.isAnEndpoint(t))return 0;var e=_(this.leftSE.point,this.vector(),t.x);if(null!==e){if(t.y<e.y)return-1;if(t.y>e.y)return 1}return 0}},{key:"touches",value:function(t){if(!function(t,e){return(c(t.ll.x,e.x)<=0||g(t.ll.x,e.x))&&(c(e.x,t.ur.x)<=0||g(e.x,t.ur.x))&&(c(t.ll.y,e.y)<=0||g(t.ll.y,e.y))&&(c(e.y,t.ur.y)<=0||g(e.y,t.ur.y))}(this.bbox(),t))return!1;if(t===this.leftSE.point||t===this.rightSE.point)return!0;var e=k(this.leftSE.point,this.rightSE.point,t),n={x:(e.x+t.x)/2,y:(e.y+t.y)/2};return y(n,e)||y(n,t)}},{key:"getIntersection",value:function(t){var e=function(t,e){if(c(e.ur.x,t.ll.x)<0||c(t.ur.x,e.ll.x)<0||c(e.ur.y,t.ll.y)<0||c(t.ur.y,e.ll.y)<0)return null;var n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:n,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:r,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}}(this.bbox(),t.bbox());if(null===e)return null;var n=this.touches(t.leftSE.point),r=t.touches(this.leftSE.point),i=this.touches(t.rightSE.point),o=t.touches(this.rightSE.point);if(r&&n)return o&&!i?this.rightSE.point:!o&&i?t.rightSE.point:null;if(r)return i&&0===v(this.leftSE.point,t.rightSE.point)?null:this.leftSE.point;if(n)return o&&0===v(this.rightSE.point,t.leftSE.point)?null:t.leftSE.point;if(o&&i)return null;if(o)return this.rightSE.point;if(i)return t.rightSE.point;var u,s,l=function(t,e,n,r){if(0===e.x)return _(n,r,t.x);if(0===r.x)return _(t,e,n.x);if(0===e.y)return S(n,r,t.y);if(0===r.y)return S(t,e,n.y);var i=p(e,r);if(0==i)return null;var o={x:n.x-t.x,y:n.y-t.y},u=p(o,e)/i,s=p(o,r)/i;return{x:(t.x+s*e.x+(n.x+u*r.x))/2,y:(t.y+s*e.y+(n.y+u*r.y))/2}}(this.leftSE.point,this.vector(),t.leftSE.point,t.vector());return null===l?null:(s=l,c((u=e).ll.x,s.x)<=0&&c(s.x,u.ur.x)<=0&&c(u.ll.y,s.y)<=0&&c(s.y,u.ur.y)<=0?l:null)}},{key:"split",value:function(t){t.sort(v);for(var n=this,r=null,i=[],o=0,u=t.length;o<u;o++){var s=t[o];if(!r||0!==v(r,s)){var l=void 0!==s.events,h=new I(s,!0),f=new I(s,!1),a=n.rightSE;n.replaceRightSE(f),i.push(f),i.push(h),n=new e(h,a,n.ringsIn.slice()),l&&(h.segment.checkForConsuming(),f.segment.checkForConsuming()),r=s}}return i}},{key:"checkForConsuming",value:function(){if(1!==this.leftSE.point.events.length&&1!==this.rightSE.point.events.length)for(var t=0,e=this.leftSE.point.events.length;t<e;t++){var n=this.leftSE.point.events[t];if(n!==this.leftSE)for(var r=0,i=this.rightSE.point.events.length;r<i;r++){var o=this.rightSE.point.events[r];o!==this.rightSE&&(n.segment===o.segment&&this.consume(n.segment))}}}},{key:"consume",value:function(t){for(var n=this,r=t;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var i=e.compare(n,r);if(0!==i){if(i>0){var o=n;n=r,r=o}if(n.prev===r){var u=n;n=r,r=u}for(var s=0,l=r.ringsIn.length;s<l;s++)n.ringsIn.push(r.ringsIn[s]);r.ringsIn=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){var t="prevInResult";return void 0===this._cache[t]&&(this._cache[t]=this["_".concat(t)]()),this._cache[t]}},{key:"_prevInResult",value:function(){return this.prev?this.prev.isInResult()?this.prev:this.prev.prevInResult():null}},{key:"ringsBefore",value:function(){var t="ringsBefore";return void 0===this._cache[t]&&(this._cache[t]=this["_".concat(t)]()),this._cache[t]}},{key:"_ringsBefore",value:function(){return this.prev?(this.prev.consumedBy||this.prev).ringsAfter():[]}},{key:"ringsAfter",value:function(){var t="ringsAfter";return void 0===this._cache[t]&&(this._cache[t]=this["_".concat(t)]()),this._cache[t]}},{key:"_ringsAfter",value:function(){for(var t=this.ringsBefore().slice(0),e=0,n=this.ringsIn.length;e<n;e++){var r=this.ringsIn[e],i=t.indexOf(r);-1===i?t.push(r):t.splice(i,1)}return t}},{key:"multiPolysBefore",value:function(){var t="multiPolysBefore";return void 0===this._cache[t]&&(this._cache[t]=this["_".concat(t)]()),this._cache[t]}},{key:"_multiPolysBefore",value:function(){return this.prev?(this.prev.consumedBy||this.prev).multiPolysAfter():[]}},{key:"multiPolysAfter",value:function(){var t="multiPolysAfter";return void 0===this._cache[t]&&(this._cache[t]=this["_".concat(t)]()),this._cache[t]}},{key:"_multiPolysAfter",value:function(){for(var t=[],e=[],n=this.ringsAfter(),r=0,i=n.length;r<i;r++){var o=n[r],u=o.poly;if(-1===e.indexOf(u))if(o.isExterior)t.push(u);else{-1===e.indexOf(u)&&e.push(u);var s=t.indexOf(o.poly);-1!==s&&t.splice(s,1)}}for(var l=[],h=0,f=t.length;h<f;h++){var a=t[h].multiPoly;-1===l.indexOf(a)&&l.push(a)}return l}},{key:"isInResult",value:function(){var t="isInResult";return void 0===this._cache[t]&&(this._cache[t]=this["_".concat(t)]()),this._cache[t]}},{key:"_isInResult",value:function(){if(this.consumedBy)return!1;var t=this.multiPolysBefore(),e=this.multiPolysAfter();switch(G.type){case"union":return 0===t.length!==(0===e.length);case"intersection":var n,r;return t.length<e.length?(n=t.length,r=e.length):(n=e.length,r=t.length),r===G.numMultiPolys&&n<r;case"xor":return Math.abs(t.length-e.length)%2==1;case"difference":var i=function(t){return 1===t.length&&t[0].isSubject};return i(t)!==i(e);default:throw new Error("Unrecognized operation type found ".concat(G.type))}}}],[{key:"fromRing",value:function(t,n,r){var i,o,u=v(t,n);if(u<0)i=new I(t,!0),o=new I(n,!1);else{if(!(u>0))throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(n.y,"]"));i=new I(n,!0),o=new I(t,!1)}return new e(i,o,[r])}}]),e}(),O=function(){function e(n,r,i){t(this,e),this.poly=r,this.isExterior=i,this.segments=[];for(var o=n[0],u=1,s=n.length;u<s;u++){var l=n[u];this.segments.push(B.fromRing(o,l,this)),o=l}this.segments.push(B.fromRing(o,n[0],this))}return n(e,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.segments.length;e<n;e++){var r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}}]),e}(),L=function(){function e(n,r){t(this,e),this.exteriorRing=new O(n[0],this,!0),this.interiorRings=[];for(var i=1,o=n.length;i<o;i++)this.interiorRings.push(new O(n[i],this,!1));this.multiPoly=r}return n(e,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,n=this.interiorRings.length;e<n;e++)for(var r=this.interiorRings[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),e}(),z=function(){function e(n){t(this,e),this.polys=[];for(var r=0,i=n.length;r<i;r++)this.polys.push(new L(n[r],this));this.isSubject=!1}return n(e,[{key:"markAsSubject",value:function(){this.isSubject=!0}},{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++)for(var r=this.polys[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),e}(),M=function(){function e(n){t(this,e),this.events=n;for(var r=0,i=n.length;r<i;r++)n[r].segment.ringOut=this;this.poly=null}return n(e,null,[{key:"factory",value:function(t){for(var n=[],r=0,i=t.length;r<i;r++){var o=t[r];if(o.isInResult()&&!o.ringOut){for(var u=null,s=o.leftSE,l=o.rightSE,h=[s],f=s.point,a=[];u=s,s=l,h.push(s),s.point!==f;)for(;;){var c=s.getAvailableLinkedEvents();if(0===c.length){var v=h[0].point,g=h[h.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(v.x,",")+" ".concat(v.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(1===c.length){l=c[0].otherSE;break}for(var y=null,p=0,x=a.length;p<x;p++)if(a[p].point===s.point){y=p;break}if(null===y){a.push({index:h.length,point:s.point});var E=s.getLeftmostComparator(u);l=c.sort(E)[0].otherSE;break}var m=a.splice(y)[0],d=h.splice(m.index);d.unshift(d[0].otherSE),n.push(new e(d.reverse()))}n.push(new e(h))}}return n}}]),n(e,[{key:"getGeom",value:function(){for(var t=this.events[0].point,e=[t],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,o=this.events[n+1].point;0!==E(i,t,o)&&(e.push(i),t=i)}if(1===e.length)return null;var u=e[0],s=e[1];0===E(u,t,s)&&e.shift(),e.push(e[0]);for(var l=this.isExteriorRing()?1:-1,h=this.isExteriorRing()?0:e.length-1,f=this.isExteriorRing()?e.length:-1,a=[],c=h;c!=f;c+=l)a.push([e[c].x,e[c].y]);return a}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],e=1,n=this.events.length;e<n;e++){var r=this.events[e];I.compare(t,r)>0&&(t=r)}for(var i=t.segment.prevInResult(),o=i?i.prevInResult():null;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}]),e}(),C=function(){function e(n){t(this,e),this.exteriorRing=n,n.poly=this,this.interiorRings=[]}return n(e,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,n=this.interiorRings.length;e<n;e++){var r=this.interiorRings[e].getGeom();null!==r&&t.push(r)}return t}}]),e}(),j=function(){function e(n){t(this,e),this.rings=n,this.polys=this._composePolys(n)}return n(e,[{key:"getGeom",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++){var r=this.polys[e].getGeom();null!==r&&t.push(r)}return t}},{key:"_composePolys",value:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];if(!i.poly)if(i.isExteriorRing())e.push(new C(i));else{var o=i.enclosingRing();o.poly||e.push(new C(o)),o.poly.addInterior(i)}}return e}}]),e}(),V=function(){function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.compare;t(this,e),this.queue=n,this.tree=new h(r),this.segments=[]}return n(e,[{key:"process",value:function(t){var e=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),n;var r=t.isLeft?this.tree.insert(e):this.tree.find(e);if(!r)throw new Error("Unable to find segment "+"#".concat(e.leftSE.id," [").concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> ")+"#".concat(e.rightSE.id," [").concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var i=r,o=r,u=void 0,s=void 0;void 0===u;)null===(i=this.tree.prev(i))?u=null:void 0===i.key.consumedBy&&(u=i.key);for(;void 0===s;)null===(o=this.tree.next(o))?s=null:void 0===o.key.consumedBy&&(s=o.key);if(t.isLeft){var l=[];if(u){var h=u.getIntersection(e);if(null!==h&&(e.isAnEndpoint(h)||l.push(h),!u.isAnEndpoint(h)))for(var f=this._splitSafely(u,h),a=0,c=f.length;a<c;a++)n.push(f[a])}if(s){var v=s.getIntersection(e);if(null!==v&&(e.isAnEndpoint(v)||l.push(v),!s.isAnEndpoint(v)))for(var g=this._splitSafely(s,v),y=0,p=g.length;y<p;y++)n.push(g[y])}if(l.length>0){this.queue.remove(e.rightSE),n.push(e.rightSE);for(var x=e.split(l),E=0,m=x.length;E<m;E++)n.push(x[E])}n.length>0?(this.tree.remove(e),n.push(t)):(this.segments.push(e),e.prev=u)}else{if(u&&s){var d=u.getIntersection(s);if(null!==d){if(!u.isAnEndpoint(d))for(var k=this._splitSafely(u,d),S=0,_=k.length;S<_;S++)n.push(k[S]);if(!s.isAnEndpoint(d))for(var w=this._splitSafely(s,d),R=0,b=w.length;R<b;R++)n.push(w[R])}}this.tree.remove(e)}return n}},{key:"_splitSafely",value:function(t,e){this.tree.remove(t);var n=t.rightSE;this.queue.remove(n);var r=t.split([e]);return r.push(n),void 0===t.consumedBy&&this.tree.insert(t),r}}]),e}(),G=new(function(){function e(){t(this,e)}return n(e,[{key:"run",value:function(t,e,n){G.type=t;for(var r=[w(e)],i=0,o=n.length;i<o;i++)r.push(w(n[i]));for(var u=0,s=r.length;u<s;u++)R(r[u]),b(r[u]);for(var l=[],f=0,a=r.length;f<a;f++)l.push(new z(r[f]));l[0].markAsSubject(),G.numMultiPolys=l.length;for(var c=new h(I.compare),v=0,g=l.length;v<g;v++)for(var y=l[v].getSweepEvents(),p=0,x=y.length;p<x;p++)c.insert(y[p]);for(var E=new V(c),m=c.size,d=c.pop();d;){var k=d.key;if(c.size===m)throw new Error("Unable to pop() SweepEvent #".concat(k.id," [").concat(k.point.x,", ").concat(k.point.y,"] ")+"from queue. Please file a bug report.");for(var S=E.process(k),_=0,A=S.length;_<A;_++){var P=S[_];void 0===P.consumedBy&&c.insert(P)}m=c.size,d=c.pop()}var B=M.factory(E.segments);return new j(B).getGeom()}}]),e}());return{union:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return G.run("union",t,n)},intersection:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return G.run("intersection",t,n)},xor:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return G.run("xor",t,n)},difference:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return G.run("difference",t,n)}}});
//# sourceMappingURL=polygon-clipping.umd.min.js.map
